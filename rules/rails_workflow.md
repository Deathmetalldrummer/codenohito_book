Rails workflow
==============

Эта инструкция описывает процесс работы с существующим Ruby on Rails проектом.
В инструкции пропущена работа с git, так как подразумевается, что читатель уже сам понимает, когда нужно пулить и пушить и что такое git-клонирование.


Начало работы с новым проектом
------------------------------

* После получения ссылки на репозиторий (`git@github.com:dymio/mayak.git`, например), нужно склонировать проект на свой компьютер

* Репозиторий, по умолчанию, уже содержит файл '.ruby-version' для работы RVM, но в нём нет файла '.ruby-gemset'. Нужно создать этот файл и написать в нём название проекта в snake-case (`mayak`, `frost_naggets`, as example).

* Необходимо в папку 'config' добавить файл 'database.yml' со следующим содержанием:

  ```yaml
  development:
    adapter: postgresql
    database: project_name
    pool: 5
  ```

  Где нужно заменить 'project_name' на название проекта в snake-case.

* В консоли нужно зайти в директорию проекта (а если уже находились в ней, то выйти, и снова зайти) чтобы RVM подхватил настройки проекта. Если появилось сообщение от RVM с просьбой установить новую ruby, то нужно сделать это.

* Устанавливаем Bundler командой `gem install bundler`

* Запускаем `bundle install --without production`

* Запускаем `bin/rake db:create db:migrate db:seed` для создания базы данных, миграции в неё таблиц и заполнения демонстрационными данными.

* Запускаем `bin/rails server` и открываем в браузере страницу [localhost:3000](http://localhost:3000/)


Возобновление работы с проектом
-------------------------------

Следующие шаги следует производить после каждого нового git pull.

* Запускаем `bin/rails server` и, если не появилось ошибок, работаем спокойно, иначе смотрим следующий пункт. Если сервер уже был запущен и, сразу после git pull стал выдавать ошибку, то останавливаем сервер (`Ctrl+C`) и смотрим следующий пункт.

* Если появились ошибки, то сначала запускаем `bundle install` для установки новых гемов, а потом `bin/rake db:migrate` для проведения новых миграций. После этого снова пробуем запустить сервер.


Перезагрузка данных проекта
---------------------------

Иногда есть необходимость сбросить все данные проекта и залить по новой.
Это происходит когда делаются изменения в уже существующих миграциях или в сидах.
Поэтому backend'ер может запросить сбросить все данные после следующего пула.

* Останавливаем сервер.

* Запускаем `bin/rake db:drop db:create db:migrate db:seed` - это удаляет существующую базу данных и по новой создаёт, мигрирует и seed'ит.

* Запускаем сервер и работаем.
